package main

import (
	"fmt"
	"os"
	"os/signal"
	"syscall"
	"time"

	"fyne.io/fyne/v2"
	"fyne.io/fyne/v2/app"
	"fyne.io/fyne/v2/canvas"
	"fyne.io/fyne/v2/container"
	"fyne.io/fyne/v2/widget"
)

func MainWindow() {
	a := app.New()
	w := a.NewWindow("Nice to meet you :D")
	w.Resize(fyne.NewSize(950, 500))

	backgroundImage := canvas.NewImageFromFile("img/1667929357109.jpg")
	backgroundImage.FillMode = canvas.ImageFillOriginal

	label := widget.NewLabel("Hello, this is the creator of this malware.")
	label1 := widget.NewLabel(" I regret to inform you that your files have been encrypted. Unfortunately, you can't do anything without my help. To get the rescue software,")
	label2 := widget.NewLabel("recover your files and remove this malware, you need to purchase it. Payment only possible in bitcoin. The price is $666 in bitcoins.")
	label3 := widget.NewLabel("Bitcoin sending address: twojstarypl")

	entry := widget.NewEntry()
	entry.SetPlaceHolder("Enter Decryption Key...")

	// Button
	buttonLabel := "Decrypt"
	button := widget.NewButton(buttonLabel, func() {
		if buttonLabel == "Decrypted" {
			fmt.Println("nice")
		} else {
			fmt.Println("bad")
		}
	})

	entry.OnChanged = func(text string) {
		if text == "kR3tm@m40&mkaSK" {
			buttonLabel = "Decrypted"
			fmt.Println("Hasło zostało odgadnięte")
			os.Exit(0)
		} else {
			buttonLabel = "Unlucky"
		}
		button.SetText(buttonLabel)
	}

	//stopwatch
	timerLabel := widget.NewLabel("05:00")
	go func() {
		startTime := time.Now()
		endTime := startTime.Add(5 * time.Minute)

		for {
			currentTime := time.Now()
			remainingTime := endTime.Sub(currentTime)

			if remainingTime <= 0 {
				timerLabel.SetText("00:00")
				fmt.Printf("Data dead")
				break
			}

			minutes := int(remainingTime.Minutes())
			seconds := int(remainingTime.Seconds()) - (minutes * 60)
			timerLabel.SetText(fmt.Sprintf("%02d:%02d", minutes, seconds))

			timeString := fmt.Sprintf("%02d", minutes) + ":" + fmt.Sprintf("%02d", seconds) //Terminal stopwatch
			fmt.Println(timeString)

			time.Sleep(1 * time.Second)
		}
	}()

	content := container.NewVBox(
		backgroundImage,
		label,
		label1,
		label2,
		label3,
		entry,
		button,
		timerLabel,
	)
	w.SetContent(content)
	w.SetFixedSize(false)
	w.CenterOnScreen()
	w.ShowAndRun()
}

func main() {
	signalChannel := make(chan os.Signal, 1)
	signal.Notify(signalChannel, os.Interrupt, syscall.SIGTERM)

	fmt.Printf("Program uruchomiony.")

	MainWindow()

	<-signalChannel // Ctrl + C to close
	fmt.Printf("Program zakończony.")
}
